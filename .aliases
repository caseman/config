# Casey's Aliases

# shortcuts for piping 
alias L='less'
alias G='grep'
alias T='tee'
alias XV='xargs nvim'
alias V='nvim -'
alias H='head'
alias T='tail'
#alias NUL='> /dev/null 2>&1' rip zsh
alias F='fzf'
alias C='cut -f1 -d'
alias B='bat --color always --plain'
alias XB='xargs bat --color always --plain'
#alias U='up' I forgot what up was :'(

alias v=nvim
alias bat=batcat
alias x='chmod +x'
alias ll='ls -lh'
alias la='ls -AF'
alias ls='ls -F'
alias lt='ls -lht | head -n 20'
md() {
    mkdir -p "$1" && pushd "$1"
}
c() {
	pushd "$1" && ls -F
}
cpd() {
    if [[ -z "$@" || "$@" == "-" ]]; then
        pushd ~/ >/dev/null
    else
        pushd $@ >/dev/null
    fi
}
alias cd='cpd'
alias pd='popd >/dev/null'
alias ".."="cd .."
alias "..."="cd ../.."
alias "...."="cd ../../.."
alias "....."="cd ../../../.."

function install {
    sudo apt-get -y install $@ && nvim "+:norm Goget $@" ~/gh/config/ubuntu-setup.sh
}
alias setup="nvim ~/gh/config/ubuntu-setup.sh"
alias vrc="nvim ~/.bashrc ~/.aliases && source ~/.bashrc"
alias vspec="~/.local/share/nvim/plugged/vim-vspec/bin/vspec"
function colors {
    for colour in {1..255};     do echo -en "\033[38;5;${colour}m38;5;${colour} \n"; done | column -x
}

alias realpath='python3 -c "import os,sys; print(os.path.realpath(sys.argv[1]))"'

# Git
git-branch-fzf() {
    git --no-pager branch -vv --sort='-committerdate:iso8601' \
    | fzf +m --preview="git --no-pager log --abbrev-commit -5 {1} | bat --color always --plain" \
    | awk '{print $1}'
}
git-stash-fzf() {
	git --no-pager stash list | sed 's/: / /' \
    | fzf +m --preview-window='top:75%' \
    	     --preview='git stash show {1} && echo "---" && git --no-pager stash show --color=always -p {1}' \
    | cut -f1 -d ' '
}
git-status-fzf() {
    git --no-pager status -s | fzf -m --preview='git diff {2}' | awk '{print $2}'
}
git-log-fzf() {
    git --no-pager log --oneline \
    | fzf +m --preview-window='top:75%' --preview='git show --color=always {1}' | awk '{print $1}'
}
git-branch-current() {
    git rev-parse --abbrev-ref HEAD
}
git-main-branch() {
    git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@'
}

tags() {
    ctags -R -f ~/.cache/tags --exclude=node_modules --exclude='bazel-*' \
        ~/cbhq/exrepo \
        ~/cbhq/financing \
        ~/cbhq/moonbase \
        2>/dev/null
}

alias g=git
alias gc='git commit -m '
alias gca='git add --all && git commit'
alias g+='git add'
alias gp='git push'
alias gfo='git fetch origin && git checkout $(git-main-branch) && git merge origin/$(git-main-branch) && git prunelocal && (tags&)'
alias gfu='git fetch upstream && git checkout $(git-main-branch) && git merge upstream/$(git-main-branch) && git prunelocal'
alias grbfp='git fetch origin && git rebase origin/$(git-main-branch) && git push --force-with-lease'
alias grb='git fetch origin && git rebase origin/$(git-main-branch)'
alias gbr='git-branch-fzf | xargs git checkout'
alias gpsup='git push --set-upstream origin $(git-branch-current)'
alias gdob='git diff origin/$(git-branch-current)...$(git-branch-current)'
alias gco='git checkout'
alias gcm='git checkout $(git-main-branch)'
alias gcmu='git checkout $(git-main-branch) && gup && tags&'
alias gcob='git checkout -b'
alias gst='git status'
alias gss='git status -s'
alias gls='git ls-files -dmo'
alias gstatus='git-status-fzf | xargs git'
alias gstash='git-stash-fzf | xargs git stash'
alias glog='git-log-fzf | xargs git'
alias gs='git stash -u'
alias ga='git add -A'
alias gcd='cd $(git-root)'
alias gmod='(gcd; git checkout go.mod go.sum)'
alias git-diff-name-only-abs='git diff --name-only --line-prefix=$(git rev-parse --show-toplevel)/'
alias gchanged='(git-diff-name-only-abs $(git-main-branch)... && git-diff-name-only-abs) | sort -u | grep $(realpath "$(pwd)")'
alias gmerge='git fetch origin $(git-main-branch) && git merge origin $(git-main-branch) && git push'
alias ghurl="git config --get remote.origin.url | sed -e 's/.*@//' -e 's/.git$//' -e 's/:/\//'"
alias prs='open "https://$(ghurl)/pulls"'
alias mprs='open "https://$(ghurl)/pulls/$USER"'
alias ish='open "https://$(ghurl)/issues"'
alias gh='open "https://$(ghurl)"'
alias gsubup='git pull --recurse-submodules && git submodule update --remote --recursive'
gbdp() {
    BRANCH="$(git-branch-current)"
    git checkout $(git-main-branch) && \
    git branch --delete $BRANCH && \
    git push origin --delete $BRANCH
}

gac() {
    git-status-fzf | xargs git add && git commit --verbose
}

goog() {
    Q=$(python -c "import urllib; print urllib.quote(raw_input())" <<< "$@") && \
    /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
        "https://www.google.com/search?q=$Q" --new-window NUL
}

alias psg='ps awx | grep'
alias grep='egrep'
alias rgrep="egrep -r --exclude-dir={node_modules,.git,'bazel-*'}"
alias tf='tail -F'
alias ymd='date +%Y%m%d'

alias h='history'
alias src='source  ~/.bashrc'
namedir() {
    eval $1=\"$PWD\" ;  : ~$1
}
# alias debugzsh='zsh -xv |& ts "%.S"'

gup() {
    find . -type d -name ".git" | while read dir; do
        echo "--- Updating $(dirname $dir)"
        (cd $dir/../ && git up && git prunelocal)
    done
}

# vi: ft=bash

