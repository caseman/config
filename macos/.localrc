# local-relevant zsh aliases and funcs

export GOPATH="$(go env GOPATH)"
export PATH="$HOME/bin:$HOME/cbhq/bin:$GOPATH/bin:$PATH"
export PYTHONUSERBASE="$HOME"

alias pg="pg_ctl -D /usr/local/var/postgres"
alias pglh="psql -U postgres -h localhost -p 5432"
alias ag="ag --ignore-dir node_modules"
alias f="ag -g"
alias vrc="(cd ~/git/config && v .*rc macos/.localrc macos/*.sh)"

alias notes="(cd ~/notes && mvim --servername NOTES --remote-silent . NUL)"

alias pgb="pgbadger --prefix='%t:%r:%u@%d:[%p]:'"
alias yt="yarn run mocha --inspect -g"

# Default hub to use cbhq github enterprise 
export GITHUB_HOST="github.cbhq.net"
alias ghpr="gpsup && hub pull-request --browse"

# bootstrap nvm on-demand only when needed
if [[ -z "$NVM_BIN" ]]; then
    # note sourcing nvm.sh replaces this function
    nvm() {
        export NVM_DIR="$HOME/.nvm"
        source "/usr/local/opt/nvm/nvm.sh"
        nvm $@
    }
fi

# Automatically switch to the right node version
yarn() {
    if [[ -f .nvmrc ]]; then
        I=$(expr "$NVM_BIN" : ".*\/v$(cat .nvmrc)\/")
        [[ "$I" == "" || "$I" == "0" ]] && nvm use
    fi
    /usr/local/bin/yarn $@
}

v() {
    # Group windows by git repo or base directory
    if git rev-parse --is-inside-work-tree NUL; then
        SERVER="$(basename $(git rev-parse --show-toplevel))"
    else
        SERVER="$(basename $(pwd))"
    fi
    if [[ "$#" == "0" ]]; then
        mvim --servername "$SERVER" -c NERDTree --remote-silent .
    else
        mvim --servername "$SERVER" --remote-silent $@ NUL
    fi
}

# Fuzzy find files by name and open in vim
vf() {
    v $(ag --nocolor -g "$1" -print | fzf -0 -1)
}

# Launch vim and grep for easy browsing
vg() {
    vim -u ~/.minimal-vimrc +":so ~/.vim/scripts/grep.vim | :Ag $@"
}

alias aliases="(cd ~/git/config && v .aliases)"
alias config="(cd ~/git/config && v .*rc */.*rc .aliases)"

# vi: ft=zsh
